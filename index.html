<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <title>Claculadora</title>

    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;  
         }
         body{
             display: flex;
             justify-content: center;
             background-color: blue;
         }
         .mainContainer{
            margin: 30px 10px;
            width: 380px;
            display: flex;    
            flex-direction: column;     
            align-items: center;
            gap: 1em;            
            border: 2px white solid;
            padding: 20px;
            border-radius: 1em;
            background-color: brown;
         }
         .pantalla{
           width: 100%;           
         }
         .pantalla input{
             background-color: black;
             height: 3em;
             width: 100%;
             border: 2px white solid;
             border-radius: 0.5em;    
             color: aliceblue;
             font-size: 1.5rem;
             text-align: right;
         }
         .numeros{
             width: 100%;
             display: grid;
             grid-template-columns: 24% 24% 24% 24%;            
             justify-content: space-between;
             column-gap: 1%;
             row-gap: 1em;
             flex-wrap: wrap;
         } 
         
         .numeros input{
             height: 60px;
             border-radius: 1em;    
             font-size: 1.2rem;
             font-weight: bolder;
         }        
         .operacion{
            border-radius: 1em;    
            font-size: 1.2rem;
            font-weight: bolder;
            height: 60px;
            background-color: aqua;
         }
         .on{
            border-radius: 1em; 
            font-size: 1.2rem;
            font-weight: bolder; 
            height: 60px;  
            background-color: red;
            border-color: aliceblue;
         }
         .numeros input:active{
            background-color: blueviolet;
         }
         .numeros button:active{
            background-color: blueviolet;
         }
    </style>
</head>
<body>

    <div class="mainContainer">
        <div class="pantalla">
            <input type="text" id="pantalla" inputmode="numeric" >
        </div>
        <div class="numeros">          
            <button class="operacion"></button>
            <button class="operacion"></button>
            <button class="operacion"></button>           
            <button class="operacion" id="borrar" onclick="borrarUltimo()" ><i class="bi bi-backspace-fill"></i></button>       
            <input type="button" id="n7" value="7">
            <input type="button" id="n8" value="8">
            <input type="button" id="n9" value="9">            
            <button class="operacion" id="operacion" >÷</button>          
            <input type="button" id="n4" value="4">
            <input type="button" id="n5" value="5">
            <input type="button" id="n6" value="6">   
            <button class="operacion" id="operacion" >x</button>         
            <input type="button" id="n1" value="1">
            <input type="button" id="n2" value="2">
            <input type="button" id="n3" value="3">  
            <button class="operacion" id="operacion" >-</button>        
            <input type="button" id="n0" value="0"> 
            <input type="button" id="n00" value="00">
            <input type="button" id="n000" value="000">
            <button class="operacion" id="operacion" >+</button> 
            <button class="on" id="on" >ON</button> 
            <input type="button" id="np" value="."> 
            <button class="operacion" id="ac" onclick="borrarTodo()">AC</button>                     
            <button class="operacion" id="resultadon" onclick="calcular()">=</button>  
             
            
    </div>
    </div>
<!---------------------------------JS---------------------------------------------------------->   
<script>      
    //--------------------MOSTRAR LOS ELEMENTOS DEL TECLADO------------------------        
    const pantalla = document.getElementById('pantalla');
    pantalla.focus();
    // Obtener todos los inputs numéricos
    const inputsNumericos = document.querySelectorAll('input[id^="n"]');
    // Iterar sobre los inputs numéricos y agregar un manejador de eventos
    inputsNumericos.forEach((input) => {
    input.addEventListener('click', () => {
    pantalla.value += input.value; // Agregar el valor del input a la pantalla
        });
    });       
    //------------------------ESCRIBIR EN LA PANTALLA----------------------------------- 
    // Obtener la pantalla y los botones de operación
    const botonesOperaciones = document.querySelectorAll('#operacion');

    // Función para manejar las pulsaciones de teclas
    document.addEventListener('keydown', (event) => {
    // Obtener el código de la tecla presionada
    const keyCode = event.keyCode;
    
    // Verificar si la tecla presionada es un número o un operador
    if ((keyCode >= 48 && keyCode <= 57) || (keyCode >= 96 && keyCode <= 105)) {
        // Teclas de números (48-57 son las teclas numéricas, 96-105 son las teclas numéricas del teclado numérico)
        pantalla.value += event.key; // Agregar el valor de la tecla a la pantalla
    } else if (keyCode === 187 || keyCode === 107 || keyCode === 189 || keyCode === 109 || keyCode === 191 || keyCode === 111) {
        // Teclas de operadores (+, -, *, /)
        let operador;
        switch (keyCode) {
            case 187:
            case 107:
                operador = '+';
                break;
            case 189:
            case 109:
                operador = '-';
                break;
            case 191:
            case 111:
                operador = '/';
                break;
            case 56:
                operador = '*';
                break;
            default:
                break;
        }
        pantalla.value += ' ' + operador + ' '; // Agregar el operador a la pantalla
        }
    });

    // Agregar eventos de clic a los botones de operación
    botonesOperaciones.forEach((boton) => {
    boton.addEventListener('click', () => {
        pantalla.value += ' ' + boton.textContent + ' '; // Agregar el valor del botón a la pantalla
        });
    });

    //-------------------------FUNCION CALCULAR------------------------------------------------------
    function calcular() {                   
        // Obtener el valor del input
        const pantallaValue = document.getElementById('pantalla').value; 
        // Separar los números y el operador
        const partes = pantallaValue.split(' '); // Suponemos que el usuario ingresa un espacio entre cada parte de la operación
        const num1 = parseFloat(partes[0]);
        const operador = partes[1];
        const num2 = parseFloat(partes[2]);
                  
        // Realizar la operación
        let resultado;
        switch (operador) {
            case '+':
                resultado = num1 + num2;
            break;
            case '-':
                resultado = num1 - num2;
            break;
            case 'x':
                resultado = num1 * num2;
            break;
            case '÷':
                resultado = num1 / num2;
            break;
            default:
                pantalla.value = 'Operador no válido';
            return;
            }                
        //Esta funcion es para que muestre el resultado separado por miles
        function formatearNumeroConSeparadores(numero) {
        return numero.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }               
        const numeroFormateado = formatearNumeroConSeparadores(resultado);                   
        // Mostrar el resultado 
        pantalla.value = String(numeroFormateado);              
    }
    //-----------------FUNCIONES DE ALGUNAS TECLAS--------------------------------------------------------------               
    function borrarUltimo(){
        let valor = pantalla.value;  
        valor = valor.slice(0, -1);
        pantalla.value = valor;
        }
    function borrarTodo(){
        pantalla.value = '';
        }
    //------------VALIDAR TECLAS Y SOLO PERMITE NUMEROS Y OPERADORES---------------------------------------------------   
        function validarCaracter(tecla) {
        // Expresión regular para caracteres permitidos: dígitos del 0 al 9, ÷, +, -, x, %
        const patron = /[0-9÷+\-x%]/;
        return patron.test(tecla);
            }
        // Obtener el input
        // Evento keydown para validar el carácter ingresado
        pantalla.addEventListener('keydown', function(event) {
            if (!validarCaracter(event.key)) {
            // Si el carácter no es válido, prevenir su inserción en el input
                event.preventDefault();
                }
        });
    //--------------------------------------------------------------------------------
               
</script>    
</body>
</html>